<!DOCTYPE html>

<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <script src="avalon.repeat.js"></script>
        <script>
            avalon.define("xxx", function(vm) {
                vm.data = [{checked: false}, {checked: false}, {checked: false}]
                vm.allchecked = false
                vm.$one = "yyyyyyyyyyy"
                vm.checkAll = function() {

                    var vmodel = avalon.vmodels.xxx
                    var bool = vmodel.allchecked = this.checked
                    vmodel.data.forEach(function(el) {
                        el.checked = bool
                    })
                }
                vm.checkOne = function($index) {
                    var vmodel = avalon.vmodels.xxx
                    avalon.bind("click", this, function() {
                        setTimeout(function() {
                            console.log($index)
                            if (!this.checked) {
                                vmodel.allchecked = false
                            } else {
                                vmodel.allchecked = vmodel.data.every(function(el) {
                                    return el.checked
                                })
                            }
                        })
                    })

                }
            })
        </script>
    </head>
    <body>
        
        <table ms-controller="xxx" border="1">
            <tr>
                <td><input type="checkbox" ms-duplex-radio="allchecked" data-duplex-changed="checkAll"/>全选{{$one}}</td>
            </tr>
            <tr ms-repeat="data">
                <td><input type="checkbox"  ms-duplex-radio="el.checked" ms-scan="checkOne(el,$index)"/>xxxxxxxxxxxx</td>
            </tr>
        </table>
    </body>
</html>
