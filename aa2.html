<!DOCTYPE html>
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <script src="avalon.js"></script>
        <style>
            .wrapper {

                overflow-y: scroll;
                border: 1px solid green;
                height: 210px;
            }
            table{
                border:1px solid red;
                border-collapse: collapse;
                position: absolute;
            }
            tr{
                height: 20px;   
            }
            td{
                border:1px solid  red;
            }
        </style>
        <script>
            var array = avalon.range(1, 100)
            var startIndex = 0
            var endIndex = 10
            var vmodel = avalon.define("grid", function(vm) {
                vm.data = array
                vm.top = 0
                vm.$skipArray = "data"
                vm._data = array.slice(startIndex, endIndex)
            })
            var trHeight = 20
            avalon.ready(function() {
                var wrapper = document.getElementById("wrapper")
                var table = document.getElementById("table")
                var tableHeight = table.offsetHeight
                var trHeight = Math.ceil(tableHeight / vmodel._data.size())
                console.log(trHeight * 10)

                var prevScrollTop = 0
                var lastRenderedScrollTop = 0
                avalon.bind(wrapper, "scroll", function(e) {
                    var scrollTop = wrapper.scrollTop
                    var scrollDir = scrollTop > prevScrollTop ? "down" : "up"
                    prevScrollTop = scrollTop
                 
                    if (Math.abs(lastRenderedScrollTop - scrollTop) > trHeight) {
                        lastRenderedScrollTop = scrollTop
                           vmodel.top = scrollTop
                        if (scrollDir === "down") {
                            //console.log("11111111111111")
                            if (endIndex + 1 < vmodel.data.length) {
                                vmodel._data.shift()
                                startIndex++
                                
                                endIndex++
                                vmodel._data.push(vmodel.data[endIndex])
                            }
                        } else {
                            console.log(startIndex)
                            if (startIndex - 1 >= 0) {
                                startIndex--
                                endIndex--
                                 vmodel._data.pop()
                                vmodel._data.unshift(vmodel.data[startIndex])
                               
                            }
                        }

                    }


                })
            })
        </script>

    </head>
    <body>
        <div ms-controller="grid">
            <div class="wrapper" id="wrapper">
                <div style="position: relative;height: 2000px">


                    <table ms-css-top="top" id="table">
                        <tbody>
                            <tr ms-repeat="_data"><td>1111111</td><td>{{el}}</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </body> 
</html>