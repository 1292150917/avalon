<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>UI-demo</title>
        <script src="avalon.js"></script>
    </head>
    <body>
        <div ms-controller="test">
            <div ms-repeat="fan_list" ms-widget="follow"></div>
        </div>
        <script>


            avalon.ui.follow = function(element, data, vmodels) {
                //4 构建组建的ViewModel
                console.log(vmodels)
                var proxy = vmodels[0].el//在这里到ms-repeat生成的 el对象
                console.log(proxy)
                var model = avalon.define(proxy.user_id, function(v) {

                    v.txt = "关注";

                    v.$init = function() {//初始化 组件的界面
                        avalon.nextTick(function() {

                            element.innerHTML = '<div ms-controller="' + proxy.user_id + '" style="background:#000;color:#ff0">{{txt}}</div>'
                            avalon.scan(element, [model].concat(vmodels))
                        })
                    }

                });


                return model;
            };

            avalon.define("test", function(v) {
                v.fan_list = [
                    {user_id: "a10000", is_follow: 1},
                    {user_id: "a10002", is_follow: 0}
                ]
            })
        </script>
    </body>
</html>