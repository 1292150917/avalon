<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link href="//cdn.bootcss.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet">

        <script src="../dist/avalon.js"></script>


    </head>
    <body>
        <div ms-controller="test">
            <xmp ms-widget="{is:'ms-select', items:@items, value:@value}"></xmp>
        </div>


        <div id="select_tpl" style="display:none;" ms-skip>
           
        </div>
        <script>
var vm = avalon.define({
    $id: 'test',
    items: ['请选择', '选项一', '选项二'],
    value: '请选择'
});
function heredoc(fn) {
    return fn.toString().replace(/^[^\/]+\/\*!?\s?/, '').
            replace(/\*\/[^\/]+$/, '').trim().replace(/>\s*</g, '><')
}
avalon.component("ms-select", {
    template: heredoc(function(){
        /*
 <div ms-class="['btn-group', (@open?'open':'')]">
        <a name="open_select" class="btn dropdown-toggle" 
           data-toggle="dropdown" ms-click="@openDropDown | prevent" href="#">
            {{@value}}
            <span class="caret"></span>
        </a>
        <ul class="dropdown-menu" >
            <li ms-for="(key, val) in @items" >
                <a href="javascript:;" class="not-close" 
                   ms-click="@select(key, $event)">{{val}}</a>
            </li>
        </ul>
    </div>
         */
    }),
    defaults: {
        items: [],
        value: '',
        open: false,
        canClose: false,
        onInit: function (e) {
            var vm = this;
            avalon(document).bind('click', function (e) {
                if (e.target.name !== 'open_select') {
                    vm.open = false
                }
            })
        },
        select: function (key) {
            var old = this.value
            var neo = this.items[key]
            if (old !== neo) {
                this.value = neo
                if (this.hasOwnProperty('onSelect') && this.onSelect === 'function') {
                    var ret = this.onSelect(neo, old)
                    if (ret !==  false) {
                        this.open = false
                    }
                }
            }
        },
        openDropDown: function () {
            this.open = true
        }
    }
});

        </script>
    </body>
</html>